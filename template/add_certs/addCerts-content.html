{{define "addCerts-content"}}
<div class="row">
  <!-- Блок серверов -->
  <div class="col-2">
    <div class="left-core">
      <div id="search-server" class="search-input-container-server">
        <input type="text" class="search-input" name="search-server" placeholder="Search object">
      </div>
      {{template "serverList-certs-tpl" .}}
    </div>
  </div>
  
  <!-- Блок формы создания сертификата -->
  <div class="col-7">
    <div><ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#" hx-get="/overview" 
        hx-target="#main-content" 
        hx-swap="innerHTML" 
        hx-push-url="true">Overview</a></li>  
      <li class="breadcrumb-item"><a href="#" hx-get="/add_server_entity" 
        hx-target="#main-content" 
        hx-swap="innerHTML" 
        hx-push-url="true">Add entities</a></li>
      <li class="breadcrumb-item"><a href="#" hx-get="/add_server" 
        hx-target="#main-content" 
        hx-swap="innerHTML" 
        hx-push-url="true">Add servers</a></li>
      <li class="breadcrumb-item active" aria-current="page">Add servers certs</li>
      <li class="breadcrumb-item"><a href="#" hx-get="/revoke_certs" 
        hx-target="#main-content" 
        hx-swap="innerHTML" 
        hx-push-url="true">Revoke servers certs</a></li>
    </ol></div> 

    <div class="core-certs">
    <form class="" 
      hx-post="/add_certs" 
      hx-swap="none"
      hx-ext="json-enc-custom" 
      parse-types="true"
      hx-on::after-request="
        if (event.detail.xhr.responseText) {
          try {
            const response = JSON.parse(event.detail.xhr.responseText);
            if (response.status === 'error') {
              Swal.fire({
                showClass: { popup: 'animate__animated animate__fadeInUp animate__fast' },
                hideClass: { popup: 'animate__animated animate__fadeOutDown animate__fast' },
                customClass: 'custom-alert',
                icon: 'error',
                title: 'Error',
                text: response.message,
                confirmButtonColor: '#3085d6'
              });
            } else if (response.status === 'success') {
              Swal.fire({
                showClass: { popup: 'animate__animated animate__fadeInUp animate__fast' },
                hideClass: { popup: 'animate__animated animate__fadeOutDown animate__fast' },
                customClass: 'custom-alert',
                icon: 'success',
                title: 'Success',
                text: `Certificate for domain ${response.domain} was successfully created`,
                confirmButtonColor: '#3085d6'
              }).then(() => {
                htmx.ajax('GET', '/cert_list', {
                  target: '#response', 
                  swap: 'innerHTML',  
                  values: {
                    serverId: document.getElementById('serverId').value
                  } 
                });
              });
            }
          } catch (e) {
            console.error('Error processing response:', e);
          }
        }
      ">
      <label id= "" class="form_lable" >Create server certificate</label>
      <div class="input_border color-form-certs">
        <div class="row g-3 form_center">
          <div class="col-md-3">
            <label class="select_title">Algorithm</label>
              <select id="select-type" name="Algorithm" class="select">
                <option value="RSA" selected>RSA</option>
                <option value="ECDSA">ECDSA</option>
                <option value="ED25519">ED25519</option>
              </select>
          </div>
          <div class="col-md-3">
            <label class="select_title">Key Length</label>
              <!-- RSA -->
              <select id="select-key-length-rsa" class="select key-length-selector" data-algorithm="RSA" type="number">  
                <option value="2048">2048 bits</option>
                <option value="4096" selected>4096 bits</option>
                <option value="8192">8192 bits</option>
              </select>
              <!-- ECDSA -->
              <select id="select-key-length-ecdsa" class="select key-length-selector" data-algorithm="ECDSA" type="number" style="display:none;">  
                <option value="256" selected>P-256 (256 bit)</option>
                <option value="384">P-384 (384 bit)</option>
                <option value="521">P-521 (521 bit)</option>
              </select>
              <!-- ED25519 -->
              <select id="select-key-length-ed25519" class="select key-length-selector" data-algorithm="ED25519" type="number" style="display:none; pointer-events:none; opacity:0.6;">  
                <option value="256" selected>256 bits</option>
              </select>
              <!-- Скрытое поле для отправки значения длины ключа-->
              <input type="hidden" name="KeyLength" id="key-length-value" value="4096">
          </div>
          <div class="col-md-3">
            <label class="select_title">TTL</label>
            <input type="number" class="c_input" id="ttl" name="TTL" placeholder="TTL" value="365" required>
          </div>
          <div class="col-md-3">
            <label class="select_title">Domain</label>
            <input type="text" class="c_input" id="domain" name="Domain" placeholder="tlss.ru" required>
            <div class="form-check form-switch switch_label">
              <label class="form-check-label" for="SwitchWildcard">Wildcard</label>
              <input class="form-check-input" type="checkbox" role="switch" id="SwitchWildcard" name="Wildcard">
            </div>
            <div class="form-check form-switch">
              <label class="form-check-label" for="SwitchRecreate">Recreate</label>
              <input class="form-check-input" type="checkbox" role="switch" id="SwitchRecreate" name="Recreate"  checked>
            </div>
            <div class="form-check form-switch">
              <label class="form-check-label" for="SwitchSaveOnServer">Save on server</label>
              <input class="form-check-input" type="checkbox" role="switch" id="SwitchSaveOnServer" name="SaveOnServer">
            </div>
          </div>
        </div>
        <div class="row g-3 form_center">
          <div class="col-md-3">
            <label class="select_title" title="Обязательное поле">Common Name</label>
            <input title="Обязательное поле" type="text" class="c_input" id="Common" name="CommonName" placeholder="CN" required>
          </div>

          <div class="col-md-9">
            <label class="select_title">Subject Alternative Names</label>
            <div class="tags-container">
              <input type="text" 
                id="san-input"
                class="c_input tag-input"
                placeholder="izhevsk.dynamics.ru, www.example.ru, 1.1.1.1">
              
              <div id="san-tags" class="tags">
                <!-- Теги будут добавляться сюда -->
              </div>
              <input type="hidden" name="SAN" id="san-values" value="" data-string="true">
            </div>
          </div>
          
          <div class="indent-5"></div>
        </div>
        <div class="row g-3 form_center">
          <div class="col-md-3">
            <label class="select_title">Country Name</label>
            <input type="text" class="c_input" id="Country" name="CountryName" placeholder="RU" required>
          </div>
          <div class="col-md-3">
            <label class="select_title">State or Province</label>
            <input type="text" class="c_input" id="State" name="StateProvince" placeholder="Udmurt Republic" required>
          </div>
          <div class="col-md-3">
            <label class="select_title">Locality Name</label>
            <input type="text" class="c_input" id="Locality" name="LocalityName" placeholder="Izhevsk" required>
          </div>
          <div class="col-md-3">
            <label class="select_title">App type</label>
              <select id="select-app-type" name="AppType" class="select" type="number" placeholder="pub.pem \ priv.key">  
                <option value="nginx">nginx</option>
                <option value="haproxy" selected>haproxy</option>
              </select>
          </div>
        </div>
        <div class="indent-5"></div> 
        <div class="row g-3 form_center">
          <div class="col-md-3">
            <label class="select_title">Organization Name</label>
            <input type="text" class="c_input" id="Organization" name="Organization" placeholder="LV Inc." required>
          </div>
          <div class="col-md-3">
            <label class="select_title">Organizational Unit</label>
            <input type="text" class="c_input" id="Unit" name="OrganizationUnit" placeholder="IT" required>
          </div>
          <div class="col-md-3">
            <label class="select_title">Email Address</label>
            <input type="email" class="c_input" id="Email" name="Email" placeholder="tdv@test.ru" required>
          </div>

          <div class="col-md-3" style="display: none;">
            <input type="number" id="serverId" name="ServerId" value="">
          </div>
          <div class="col-md-3" style="display: none;">
            <input type="text" id="serverStatus" name="ServerStatus" value="">
          </div>
          
          <div class="btn-container btn-container-right">
            <button type="submit" class="btn-custom btn-custom-certs" id="create-cert-btn">
              <span class="btn-text">Create</span>
              <img src="/static/svg/time.svg" class="time-svg htmx-indicator">
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
</div>

<!-- Поиск и список сертификатов -->
<div class="row mt-2">
  <div class="col-12">
    <div id="search-certs" class="search-input-container">
      <input type="text" class="search-input" name="search-certs" placeholder="Search certs">
    </div>
    <div id="response" class="server-cert-tables">
      {{template "certList-tpl" .}}
    </div>
  </div>
</div>
{{end}}

